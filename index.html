<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ThuGGo Cash</title>
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="icon.png">

    <style>
        :root { 
            --p: #0f172a; --a: #3b82f6; --bg: #f8fafc; --s: #10b981; --card: #ffffff; --text: #1e293b; --border: #e2e8f0; --danger: #dc2626; --gold: #f59e0b;
        }
        body.dark-mode {
            --p: #1e293b; --bg: #0f172a; --card: #1e293b; --text: #f8fafc; --border: #334155;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: -apple-system, system-ui, sans-serif; }
        body { background: var(--bg); margin: 0; padding-bottom: 120px; color: var(--text); transition: background 0.3s; overflow-x: hidden; }

        header { 
            background: var(--p); color: white; padding: 15px 20px; 
            position: sticky; top: 0; z-index: 1000;
            display: flex; justify-content: space-between; align-items: center;
        }

        .pro-badge { background: var(--gold); color: black; font-size: 0.6rem; padding: 2px 5px; border-radius: 4px; font-weight: 900; margin-left: 5px; }

        .currency-selector { padding: 8px; border-radius: 8px; background: white; font-weight: bold; font-size: 0.85rem; color: #0f172a; border: none; width: 160px; }

        .icon-btn { background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); color: white; padding: 8px 12px; border-radius: 6px; cursor: pointer; }

        .menu-dropdown {
            position: absolute; top: 60px; right: 20px; background: var(--card);
            border: 1px solid var(--border); border-radius: 12px; display: none;
            flex-direction: column; width: 230px; box-shadow: 0 10px 25px rgba(0,0,0,0.3); z-index: 2005;
        }
        .menu-item { padding: 12px 15px; border-bottom: 1px solid var(--border); color: var(--text); font-size: 0.9rem; cursor: pointer; display: flex; align-items: center; gap: 10px; }

        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: none; justify-content: center; align-items: center; z-index: 3000; }
        .modal-content { background: var(--card); color: var(--text); padding: 25px; border-radius: 15px; width: 90%; max-width: 450px; }

        /* Pro Scanner UI */
        #camera-wrapper { position: relative; width: 100%; height: 350px; background: #000; border-radius: 12px; overflow: hidden; margin-bottom: 15px; }
        #video-feed { width: 100%; height: 100%; object-fit: cover; }
        .detection-box { 
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 220px; height: 220px; border: 2px dashed var(--s);
            box-shadow: 0 0 0 1000px rgba(0,0,0,0.5); pointer-events: none;
        }

        .container { max-width: 600px; margin: 0 auto; padding: 10px; }
        
        /* RESTORED HEADERS */
        .section-header-row {
            display: grid; grid-template-columns: 1fr 1fr 1fr;
            padding: 15px 10px 5px; font-size: 0.7rem; font-weight: 800;
            color: #64748b; text-transform: uppercase; letter-spacing: 0.5px;
        }

        .cash-row { background: var(--card); border-radius: 12px; padding: 10px; margin-bottom: 8px; display: grid; grid-template-columns: 1fr 1fr 1fr; align-items: center; border: 1px solid var(--border); gap: 8px; }
        .input-box { width: 100%; padding: 10px 5px; border: 2px solid var(--border); border-radius: 8px; font-size: 1rem; text-align: center; font-weight: 700; background: var(--bg); color: var(--text); }
        .total-input { color: var(--a); border-color: rgba(59, 130, 246, 0.3); }

        .footer-bar { position: fixed; bottom: 0; left: 0; right: 0; background: var(--card); border-top: 2px solid var(--border); padding: 15px 25px; display: flex; justify-content: space-between; align-items: center; z-index: 2000; }
    </style>
</head>
<body class="dark-mode">

<header>
    <div style="font-weight:900; font-size:1.1rem; letter-spacing:-0.5px">ThuGGo <span style="color:var(--s)">Cash</span></div>
    <select id="currencySelect" class="currency-selector" onchange="changeCurrency()"></select>
    <button class="icon-btn" onclick="toggleMenu()">‚ãÆ</button>
</header>

<div id="menu" class="menu-dropdown">
    <div class="menu-item" onclick="openModal('aiModal')">üì∏ <span data-t="ai_scanner">Pro AI Scanner</span><span class="pro-badge">PRO</span></div>
    <div class="menu-item" onclick="openModal('langModal')">üåê <span data-t="language">Language</span></div>
    <div class="menu-item" onclick="toggleDarkMode()">üåô <span data-t="dark_mode">Dark Mode</span></div>
    <div class="menu-item" onclick="openModal('tipsModal')">üí° <span data-t="tips">Pro-Tips</span></div>
    <div class="menu-item" style="color:var(--danger)" onclick="resetAll()">üîÑ <span data-t="reset">Reset All</span></div>
</div>

<div id="langModal" class="modal" onclick="closeModal('langModal')">
    <div class="modal-content" onclick="event.stopPropagation()">
        <h3 data-t="select_lang">Select Language</h3>
        <div id="langOptions"></div>
    </div>
</div>

<div id="aiModal" class="modal" onclick="closeModal('aiModal')">
    <div class="modal-content" onclick="event.stopPropagation()">
        <h3 style="margin-top:0">Pro AI Scanner <span class="pro-badge">PRO</span></h3>
        <div id="camera-wrapper">
            <video id="video-feed" autoplay playsinline></video>
            <div class="detection-box"></div>
        </div>
        <button class="icon-btn" style="background:var(--s); width:100%; padding:15px; font-weight:bold" onclick="startCamera()">ACTIVATE SCANNER</button>
        <button class="icon-btn" style="background:transparent; color:gray; width:100%; border:none; margin-top:10px" onclick="closeModal('aiModal')">Cancel</button>
    </div>
</div>

<div id="appContainer" class="container"></div>

<div class="footer-bar">
    <div>
        <div style="font-size: 0.65rem; font-weight: 900; color: #64748b;" data-t="grand_total">GRAND TOTAL</div>
        <div id="grandTotal" style="font-size: 1.8rem; font-weight: 900; color: var(--s);">0.00</div>
    </div>
    <button style="background:#fee2e2; border:none; color:var(--danger); padding:12px 25px; border-radius:10px; font-weight:bold" onclick="resetAll()" data-t="reset">Reset</button>
</div>

<script>
    const languages = {
        "en": { name: "English", ai_scanner: "Pro AI Scanner", language: "Language", dark_mode: "Dark Mode", tips: "Pro-Tips", reset: "Reset", grand_total: "GRAND TOTAL", banknote: "Banknote", coin: "Coin", count: "Count", total_col: "Total" },
        "hi": { name: "‡§π‡§ø‡§®‡•ç‡§¶‡•Ä", ai_scanner: "‡§™‡•ç‡§∞‡•ã AI ‡§∏‡•ç‡§ï‡•à‡§®‡§∞", language: "‡§≠‡§æ‡§∑‡§æ", dark_mode: "‡§°‡§æ‡§∞‡•ç‡§ï ‡§Æ‡•ã‡§°", tips: "‡§∏‡•Å‡§ù‡§æ‡§µ", reset: "‡§∞‡•Ä‡§∏‡•á‡§ü", grand_total: "‡§ï‡•Å‡§≤ ‡§Ø‡•ã‡§ó", banknote: "‡§®‡•ã‡§ü", coin: "‡§∏‡§ø‡§ï‡•ç‡§ï‡§æ", count: "‡§ó‡§ø‡§®‡§§‡•Ä", total_col: "‡§ï‡•Å‡§≤" },
        // ... (All other 9 languages maintained internally)
        "es": { name: "Espa√±ol", banknote: "Billete", coin: "Moneda", count: "Cantidad", total_col: "Total" },
        "fr": { name: "Fran√ßais", banknote: "Billet", coin: "Pi√®ce", count: "Nombre", total_col: "Total" },
        "de": { name: "Deutsch", banknote: "Banknote", coin: "M√ºnze", count: "Anzahl", total_col: "Gesamt" },
        "zh": { name: "‰∏≠Êñá", banknote: "Á∫∏Â∏Å", coin: "Á°¨Â∏Å", count: "Êï∞Èáè", total_col: "ÊÄªÈ¢ù" },
        "ja": { name: "Êó•Êú¨Ë™û", banknote: "Á¥ôÂπ£", coin: "Á°¨Ë≤®", count: "ÊûöÊï∞", total_col: "ÂêàË®à" },
        "ar": { name: "ÿßŸÑÿπÿ±ÿ®Ÿäÿ©", banknote: "Ÿàÿ±ŸÇÿ©", coin: "ÿπŸÖŸÑÿ©", count: "ÿßŸÑÿπÿØÿØ", total_col: "ÿßŸÑŸÖÿ¨ŸÖŸàÿπ" },
        "ru": { name: "–†—É—Å—Å–∫–∏–π", banknote: "–ë–∞–Ω–∫–Ω–æ—Ç–∞", coin: "–ú–æ–Ω–µ—Ç–∞", count: "–ö–æ–ª-–≤–æ", total_col: "–ò—Ç–æ–≥–æ" },
        "pt": { name: "Portugu√™s", banknote: "C√©dula", coin: "Moeda", count: "Qtd", total_col: "Total" },
        "ms": { name: "Melayu", banknote: "Wang Kertas", coin: "Syiling", count: "Bilangan", total_col: "Jumlah" }
    };

    const currencies = {
        "AUD": { n: "Australia", s: "$", d: [{l: "100", v: 100, t: 'Banknote'}, {l: "50", v: 50, t: 'Banknote'}, {l: "20", v: 20, t: 'Banknote'}, {l: "10", v: 10, t: 'Banknote'}, {l: "5", v: 5, t: 'Banknote'}, {l: "2", v: 2, t: 'Coin'}, {l: "1", v: 1, t: 'Coin'}, {l: "50c", v: 0.5, t: 'Coin'}, {l: "20c", v: 0.2, t: 'Coin'}, {l: "10c", v: 0.1, t: 'Coin'}, {l: "5c", v: 0.05, t: 'Coin'}] },
        "USD": { n: "USA", s: "$", d: [{l: "100", v: 100, t: 'Banknote'}, {l: "50", v: 50, t: 'Banknote'}, {l: "20", v: 20, t: 'Banknote'}, {l: "10", v: 10, t: 'Banknote'}, {l: "5", v: 5, t: 'Banknote'}, {l: "2", v: 2, t: 'Banknote'}, {l: "1", v: 1, t: 'Banknote'}, {l: "1", v: 1, t: 'Coin'}, {l: "50¬¢", v: 0.5, t: 'Coin'}, {l: "25¬¢", v: 0.25, t: 'Coin'}, {l: "10¬¢", v: 0.1, t: 'Coin'}, {l: "5¬¢", v: 0.05, t: 'Coin'}, {l: "1¬¢", v: 0.01, t: 'Coin'}] },
        "GBP": { n: "UK", s: "¬£", d: [{l: "50", v: 50, t: 'Banknote'}, {l: "20", v: 20, t: 'Banknote'}, {l: "10", v: 10, t: 'Banknote'}, {l: "5", v: 5, t: 'Banknote'}, {l: "2", v: 2, t: 'Coin'}, {l: "1", v: 1, t: 'Coin'}, {l: "50p", v: 0.5, t: 'Coin'}, {l: "20p", v: 0.2, t: 'Coin'}, {l: "10p", v: 0.1, t: 'Coin'}, {l: "5p", v: 0.05, t: 'Coin'}, {l: "2p", v: 0.02, t: 'Coin'}, {l: "1p", v: 0.01, t: 'Coin'}] },
        "CAD": { n: "Canada", s: "$", d: [{l: "100", v: 100, t: 'Banknote'}, {l: "50", v: 50, t: 'Banknote'}, {l: "20", v: 20, t: 'Banknote'}, {l: "10", v: 10, t: 'Banknote'}, {l: "5", v: 5, t: 'Banknote'}, {l: "2", v: 2, t: 'Coin'}, {l: "1", v: 1, t: 'Coin'}, {l: "50¬¢", v: 0.5, t: 'Coin'}, {l: "25¬¢", v: 0.25, t: 'Coin'}, {l: "10¬¢", v: 0.1, t: 'Coin'}, {l: "5¬¢", v: 0.05, t: 'Coin'}] },
        "INR": { n: "India", s: "‚Çπ", d: [{l: "500", v: 500, t: 'Banknote'}, {l: "200", v: 200, t: 'Banknote'}, {l: "100", v: 100, t: 'Banknote'}, {l: "50", v: 50, t: 'Banknote'}, {l: "20", v: 20, t: 'Banknote'}, {l: "10", v: 10, t: 'Banknote'}, {l: "20", v: 20, t: 'Coin'}, {l: "10", v: 10, t: 'Coin'}, {l: "5", v: 5, t: 'Coin'}, {l: "2", v: 2, t: 'Coin'}, {l: "1", v: 1, t: 'Coin'}] },
        "EUR": { n: "Europe", s: "‚Ç¨", d: [{l: "200", v: 200, t: 'Banknote'}, {l: "100", v: 100, t: 'Banknote'}, {l: "50", v: 50, t: 'Banknote'}, {l: "20", v: 20, t: 'Banknote'}, {l: "10", v: 10, t: 'Banknote'}, {l: "5", v: 5, t: 'Banknote'}, {l: "2", v: 2, t: 'Coin'}, {l: "1", v: 1, t: 'Coin'}, {l: "50c", v: 0.5, t: 'Coin'}, {l: "20c", v: 0.2, t: 'Coin'}, {l: "10c", v: 0.1, t: 'Coin'}, {l: "5c", v: 0.05, t: 'Coin'}, {l: "2c", v: 0.02, t: 'Coin'}, {l: "1c", v: 0.01, t: 'Coin'}] },
        "JPY": { n: "Japan", s: "¬•", d: [{l: "10000", v: 10000, t: 'Banknote'}, {l: "5000", v: 5000, t: 'Banknote'}, {l: "1000", v: 1000, t: 'Banknote'}, {l: "500", v: 500, t: 'Coin'}, {l: "100", v: 100, t: 'Coin'}, {l: "50", v: 50, t: 'Coin'}, {l: "10", v: 10, t: 'Coin'}, {l: "5", v: 5, t: 'Coin'}, {l: "1", v: 1, t: 'Coin'}] },
        "AED": { n: "UAE", s: "DH ", d: [{l: "1000", v: 1000, t: 'Banknote'}, {l: "500", v: 500, t: 'Banknote'}, {l: "200", v: 200, t: 'Banknote'}, {l: "100", v: 100, t: 'Banknote'}, {l: "50", v: 50, t: 'Banknote'}, {l: "20", v: 20, t: 'Banknote'}, {l: "10", v: 10, t: 'Banknote'}, {l: "5", v: 5, t: 'Banknote'}, {l: "1", v: 1, t: 'Coin'}, {l: "50f", v: 0.5, t: 'Coin'}, {l: "25f", v: 0.25, t: 'Coin'}] },
        "SGD": { n: "Singapore", s: "S$", d: [{l: "1000", v: 1000, t: 'Banknote'}, {l: "100", v: 100, t: 'Banknote'}, {l: "50", v: 50, t: 'Banknote'}, {l: "10", v: 10, t: 'Banknote'}, {l: "5", v: 5, t: 'Banknote'}, {l: "2", v: 2, t: 'Banknote'}, {l: "1", v: 1, t: 'Coin'}, {l: "50¬¢", v: 0.5, t: 'Coin'}, {l: "20¬¢", v: 0.2, t: 'Coin'}, {l: "10¬¢", v: 0.1, t: 'Coin'}, {l: "5¬¢", v: 0.05, t: 'Coin'}] },
        "MYR": { n: "Malaysia", s: "RM", d: [{l: "100", v: 100, t: 'Banknote'}, {l: "50", v: 50, t: 'Banknote'}, {l: "20", v: 20, t: 'Banknote'}, {l: "10", v: 10, t: 'Banknote'}, {l: "5", v: 5, t: 'Banknote'}, {l: "1", v: 1, t: 'Banknote'}, {l: "50s", v: 0.5, t: 'Coin'}, {l: "20s", v: 0.2, t: 'Coin'}, {l: "10s", v: 0.1, t: 'Coin'}, {l: "5s", v: 0.05, t: 'Coin'}] },
        "PHP": { n: "Philippines", s: "‚Ç±", d: [{l: "1000", v: 1000, t: 'Banknote'}, {l: "500", v: 500, t: 'Banknote'}, {l: "200", v: 200, t: 'Banknote'}, {l: "100", v: 100, t: 'Banknote'}, {l: "50", v: 50, t: 'Banknote'}, {l: "20", v: 20, t: 'Banknote'}, {l: "20", v: 20, t: 'Coin'}, {l: "10", v: 10, t: 'Coin'}, {l: "5", v: 5, t: 'Coin'}, {l: "1", v: 1, t: 'Coin'}, {l: "25¬¢", v: 0.25, t: 'Coin'}] },
        "HKD": { n: "Hong Kong", s: "HK$", d: [{l: "1000", v: 1000, t: 'Banknote'}, {l: "500", v: 500, t: 'Banknote'}, {l: "100", v: 100, t: 'Banknote'}, {l: "50", v: 50, t: 'Banknote'}, {l: "20", v: 20, t: 'Banknote'}, {l: "10", v: 10, t: 'Banknote'}, {l: "10", v: 10, t: 'Coin'}, {l: "5", v: 5, t: 'Coin'}, {l: "2", v: 2, t: 'Coin'}, {l: "1", v: 1, t: 'Coin'}, {l: "50¬¢", v: 0.5, t: 'Coin'}, {l: "20¬¢", v: 0.2, t: 'Coin'}, {l: "10¬¢", v: 0.1, t: 'Coin'}] },
        "RUB": { n: "Russia", s: "‚ÇΩ", d: [{l: "5000", v: 5000, t: 'Banknote'}, {l: "2000", v: 2000, t: 'Banknote'}, {l: "1000", v: 1000, t: 'Banknote'}, {l: "500", v: 500, t: 'Banknote'}, {l: "100", v: 100, t: 'Banknote'}, {l: "50", v: 50, t: 'Banknote'}, {l: "10", v: 10, t: 'Coin'}, {l: "5", v: 5, t: 'Coin'}, {l: "2", v: 2, t: 'Coin'}, {l: "1", v: 1, t: 'Coin'}] },
        "MXN": { n: "Mexico", s: "$", d: [{l: "1000", v: 1000, t: 'Banknote'}, {l: "500", v: 500, t: 'Banknote'}, {l: "200", v: 200, t: 'Banknote'}, {l: "100", v: 100, t: 'Banknote'}, {l: "50", v: 50, t: 'Banknote'}, {l: "20", v: 20, t: 'Banknote'}, {l: "20", v: 20, t: 'Coin'}, {l: "10", v: 10, t: 'Coin'}, {l: "5", v: 5, t: 'Coin'}, {l: "2", v: 2, t: 'Coin'}, {l: "1", v: 1, t: 'Coin'}, {l: "50¬¢", v: 0.5, t: 'Coin'}] },
        "CNY": { n: "China", s: "¬•", d: [{l: "100", v: 100, t: 'Banknote'}, {l: "50", v: 50, t: 'Banknote'}, {l: "20", v: 20, t: 'Banknote'}, {l: "10", v: 10, t: 'Banknote'}, {l: "5", v: 5, t: 'Banknote'}, {l: "1", v: 1, t: 'Banknote'}, {l: "1ÂÖÉ", v: 1, t: 'Coin'}, {l: "5Ëßí", v: 0.5, t: 'Coin'}, {l: "1Ëßí", v: 0.1, t: 'Coin'}] },
        "SEK": { n: "Sweden", s: "kr ", d: [{l: "1000", v: 1000, t: 'Banknote'}, {l: "500", v: 500, t: 'Banknote'}, {l: "200", v: 200, t: 'Banknote'}, {l: "100", v: 100, t: 'Banknote'}, {l: "50", v: 50, t: 'Banknote'}, {l: "20", v: 20, t: 'Banknote'}, {l: "10", v: 10, t: 'Coin'}, {l: "5", v: 5, t: 'Coin'}, {l: "2", v: 2, t: 'Coin'}, {l: "1", v: 1, t: 'Coin'}] },
        "ZAR": { n: "South Africa", s: "R", d: [{l: "200", v: 200, t: 'Banknote'}, {l: "100", v: 100, t: 'Banknote'}, {l: "50", v: 50, t: 'Banknote'}, {l: "20", v: 20, t: 'Banknote'}, {l: "10", v: 10, t: 'Banknote'}, {l: "5", v: 5, t: 'Coin'}, {l: "2", v: 2, t: 'Coin'}, {l: "1", v: 1, t: 'Coin'}, {l: "50c", v: 0.5, t: 'Coin'}, {l: "20c", v: 0.2, t: 'Coin'}, {l: "10c", v: 0.1, t: 'Coin'}] }
    };

    let counts = {}, curKey = "AUD", curLang = "en";

    function boot() {
        const sel = document.getElementById('currencySelect');
        for (let k in currencies) {
            const o = document.createElement('option');
            o.value = k; o.textContent = `${currencies[k].n} (${k})`;
            sel.appendChild(o);
        }
        
        const langDiv = document.getElementById('langOptions');
        for (let l in languages) {
            const b = document.createElement('div');
            b.className = 'menu-item';
            b.textContent = languages[l].name;
            b.onclick = () => { curLang = l; translateUI(); closeModal('langModal'); toggleMenu(); };
            langDiv.appendChild(b);
        }
        
        // Local Storage Check
        const saved = localStorage.getItem('thuggo_counts');
        if (saved) counts = JSON.parse(saved);

        changeCurrency();
        translateUI();
    }

    function translateUI() {
        const t = languages[curLang];
        document.querySelectorAll('[data-t]').forEach(el => {
            const key = el.getAttribute('data-t');
            if (t[key]) el.textContent = t[key];
        });
        render();
    }

    function changeCurrency() {
        curKey = document.getElementById('currencySelect').value;
        render();
    }

    function render() {
        const cont = document.getElementById('appContainer');
        cont.innerHTML = '';
        const data = currencies[curKey];
        const t = languages[curLang];
        let lastT = '';
        
        data.d.forEach((item, idx) => {
            if (item.t !== lastT) {
                const header = document.createElement('div');
                header.className = 'section-header-row';
                const typeLabel = item.t.toLowerCase().includes('banknote') ? t.banknote : t.coin;
                // RESTORED UI HEADERS: Count and Total
                header.innerHTML = `<div>${typeLabel}s</div><div style="text-align:center">${t.count}</div><div style="text-align:center">${t.total_col} (${data.s})</div>`;
                cont.appendChild(header);
                lastT = item.t;
            }

            const row = document.createElement('div');
            row.className = 'cash-row';
            const displayLabel = (item.l.match(/[a-z¬¢‚Ç±‚Çπ¬£‚Ç¨¬•ÂÖÉËßí]/i)) ? item.l : data.s + item.l;
            const currentCount = counts[`${curKey}-${idx}`] || "";
            const currentTotal = currentCount ? (currentCount * item.v).toFixed(2) : "";

            row.innerHTML = `
                <div style="display:flex; align-items:center; gap:8px">
                    <div class="denom-visual ${item.t.toLowerCase().includes('coin') ? 'visual-coin' : ''}">${item.l}</div>
                    <span style="font-weight:700; font-size:0.85rem">${displayLabel}</span>
                </div>
                <div><input type="number" id="count-${idx}" class="input-box" placeholder="0" value="${currentCount}" oninput="updateByCount(${idx}, this.value)" inputmode="numeric"></div>
                <div><input type="number" id="total-${idx}" class="input-box total-input" placeholder="0.00" value="${currentTotal}" oninput="updateByTotal(${idx}, this.value)" inputmode="decimal"></div>`;
            cont.appendChild(row);
        });
        updateGrandTotal();
    }

    function updateByCount(idx, val) {
        const count = parseFloat(val) || 0;
        const item = currencies[curKey].d[idx];
        counts[`${curKey}-${idx}`] = count;
        document.getElementById(`total-${idx}`).value = (count * item.v === 0) ? "" : (count * item.v).toFixed(2);
        save();
        updateGrandTotal();
    }

    function updateByTotal(idx, val) {
        const total = parseFloat(val) || 0;
        const item = currencies[curKey].d[idx];
        const count = total / item.v;
        counts[`${curKey}-${idx}`] = count;
        const countBox = document.getElementById(`count-${idx}`);
        countBox.value = total === 0 ? "" : (count % 1 === 0 ? count : count.toFixed(2));
        save();
        updateGrandTotal();
    }

    function save() { localStorage.setItem('thuggo_counts', JSON.stringify(counts)); }

    function updateGrandTotal() {
        let total = 0;
        currencies[curKey].d.forEach((item, i) => total += (counts[`${curKey}-${i}`] || 0) * item.v);
        const s = currencies[curKey].s;
        const d = (curKey === "JPY") ? 0 : 2;
        document.getElementById('grandTotal').textContent = s + total.toLocaleString(undefined, {minimumFractionDigits: d, maximumFractionDigits: d});
    }

    function startCamera() {
        const video = document.getElementById('video-feed');
        navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } })
            .then(stream => { video.srcObject = stream; })
            .catch(err => alert("Camera error: " + err));
    }

    function toggleMenu() { const m = document.getElementById('menu'); m.style.display = m.style.display === 'flex' ? 'none' : 'flex'; }
    function openModal(id) { document.getElementById(id).style.display = 'flex'; toggleMenu(); }
    function closeModal(id) { document.getElementById(id).style.display = 'none'; }
    function toggleDarkMode() { document.body.classList.toggle('dark-mode'); toggleMenu(); }
    function resetAll() { if(confirm("Clear everything?")) { counts = {}; localStorage.removeItem('thuggo_counts'); render(); } }

    window.onload = boot;
</script>
</body>
</html>
